<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø¤Ù…Ù†Ø© | Donate Way</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; direction: rtl; padding: 20px; }
        .login-screen { position: fixed; inset: 0; background: #8e44ad; display: flex; align-items: center; justify-content: center; z-index: 100; }
        .box { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); width: 100%; max-width: 400px; }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #8e44ad; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        #admin-panel { display: none; margin: 0 auto; }
        .error { color: red; font-size: 0.8rem; display: none; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="login-screen" class="login-screen">
        <div class="box">
            <h2 style="text-align: center; color: #8e44ad;">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
            <p id="error-msg" class="error">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!</p>
            <input type="email" id="email-input" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <input type="password" id="pass-input" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
            <button onclick="login()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div id="admin-panel" class="box">
        <h2>Ø¥Ø¶Ø§ÙØ© Ø­Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
        <input type="text" id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø­Ù…Ù„Ø©">
        <textarea id="desc" placeholder="ÙˆØµÙ Ø§Ù„Ø­Ù…Ù„Ø©"></textarea>
        <input type="number" id="target" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (Pi)">
        <input type="text" id="icon" placeholder="Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© (Ù…Ø«Ø§Ù„: ğŸ±)">
        <button onclick="add()">Ø­ÙØ¸ ÙˆÙ†Ø´Ø± Ø§Ù„Ø­Ù…Ù„Ø©</button>
        <button onclick="logout()" style="background:#ccc; margin-top:10px; color:#333">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>

    <script>
        const SUPABASE_URL = 'https://xncapmzlwuisupkjlftb.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_zPECXAiI_bDbeLtRYe3vIw_IEt_p_AS';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // 1. ÙˆØ¸ÙŠÙØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        async function login() {
            const email = document.getElementById('email-input').value;
            const password = document.getElementById('pass-input').value;
            const errorElement = document.getElementById('error-msg');

            const { data, error } = await _supabase.auth.signInWithPassword({
                email: email,
                password: password,
            });

            if (error) {
                errorElement.innerText = "ÙØ´Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„: " + error.message;
                errorElement.style.display = 'block';
            } else {
                showAdminPanel();
            }
        }

        // 2. Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function showAdminPanel() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'block';
        }

        // 3. ÙˆØ¸ÙŠÙØ© Ø¥Ø¶Ø§ÙØ© Ø­Ù…Ù„Ø©
        async function add() {
            const title = document.getElementById('title').value;
            const description = document.getElementById('desc').value;
            const target_amount = document.getElementById('target').value;
            const icon = document.getElementById('icon').value;

            if (!title || !target_amount) return alert("Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

            const { error } = await _supabase.from('campaigns').insert([
                { title, description, target_amount: parseFloat(target_amount), icon }
            ]);

            if (error) alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸: " + error.message);
            else { alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©!"); location.reload(); }
        }

        // 4. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        async function logout() {
            await _supabase.auth.signOut();
            location.reload();
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø£Ø¯Ù…Ù† Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ù‡ ÙØ¹Ù„ÙŠØ§Ù‹ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        window.onload = async () => {
            const { data } = await _supabase.auth.getSession();
            if (data.session) {
                showAdminPanel();
            }
        };
    </script>
</body>
</html>
