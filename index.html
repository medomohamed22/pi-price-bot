<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pi Elite Hub 2026 | Ø³ÙˆÙ‚ Ø§Ù„Ù†Ø®Ø¨Ø©</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary: #6d28d9;
            --accent: #00f2fe;
            --glass: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --bg-gradient: radial-gradient(circle at top, #2e1065, #0f172a);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; background: #0f172a; color: white;
            font-family: 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden; min-height: 100vh;
        }

        /* Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙØ­Ø§Øª */
        .page {
            display: none; padding: 20px 15px 100px;
            animation: fadeIn 0.4s ease;
        }
        .page.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠ Glassmorphism */
        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 25px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª */
        .ads-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .ad-item { position: relative; transition: 0.3s; }
        .ad-item img { width: 100%; height: 150px; object-fit: cover; border-radius: 20px; }
        .ad-details { padding: 10px; }
        .price-tag { color: var(--accent); font-weight: 800; font-size: 1.1rem; }
        
        /* Ø§Ù„ÙØ¦Ø§Øª */
        .cat-bar { display: flex; overflow-x: auto; gap: 10px; padding: 10px 0; scrollbar-width: none; }
        .cat-bar::-webkit-scrollbar { display: none; }
        .cat-item {
            background: var(--glass); border: 1px solid var(--glass-border);
            padding: 8px 18px; border-radius: 20px; white-space: nowrap; font-size: 13px;
        }
        .cat-item.active { background: var(--accent); color: #000; font-weight: bold; border: none; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ */
        .tab-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(20px);
            display: flex; justify-content: space-around; padding: 10px 0 25px;
            border-top: 1px solid var(--glass-border); z-index: 1000;
        }
        .tab-btn { background: none; border: none; color: #64748b; font-size: 11px; display: flex; flex-direction: column; align-items: center; }
        .tab-btn i { font-size: 20px; margin-bottom: 5px; transition: 0.3s; }
        .tab-btn.active { color: var(--accent); }
        .tab-btn.active i { transform: translateY(-5px); text-shadow: 0 0 10px var(--accent); }

        /* Ø£Ø²Ø±Ø§Ø± ÙˆØ­Ù‚ÙˆÙ„ */
        .main-btn {
            background: linear-gradient(90deg, #7c3aed, #00f2fe);
            color: white; border: none; padding: 15px; border-radius: 15px;
            width: 100%; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(124, 58, 237, 0.3);
        }
        .input-box {
            width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);
            padding: 15px; border-radius: 15px; color: white; margin-bottom: 12px; outline: none;
        }

        /* Ø´Ø§Ø±Ø§Øª Ø§Ù„ØªÙˆØ«ÙŠÙ‚ ÙˆØ§Ù„Ù…ÙØ¶Ù„Ø© */
        .verified { color: var(--accent); margin-left: 5px; }
        .fav-icon { position: absolute; top: 10px; right: 10px; color: white; font-size: 18px; z-index: 10; }
        .views-badge { font-size: 10px; color: #94a3b8; display: flex; align-items: center; gap: 4px; }
    </style>
</head>
<body>

    <div id="login-page" class="page active" style="text-align: center; padding-top: 100px;">
        <div style="font-size: 80px; margin-bottom: 20px;">ğŸ’</div>
        <h1>Pi Elite Hub</h1>
        <p style="color: #94a3b8; margin-bottom: 40px;">Ø³ÙˆÙ‚ Ø§Ù„Ø±ÙˆØ§Ø¯ Ù„Ù„Ø£Ø´ÙŠØ§Ø¡ Ø§Ù„ÙØ§Ø®Ø±Ø© ÙˆØ§Ù„Ù…Ø³ØªØ¹Ù…Ù„Ø©</p>
        <button class="main-btn" onclick="authPi()" style="max-width: 250px;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Pi</button>
    </div>

    <div id="home-page" class="page">
        <div class="cat-bar">
            <div class="cat-item active" onclick="changeCat('Ø§Ù„ÙƒÙ„', this)">Ø§Ù„ÙƒÙ„</div>
            <div class="cat-item" onclick="changeCat('Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª', this)">ğŸ“± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</div>
            <div class="cat-item" onclick="changeCat('Ø£Ø«Ø§Ø«', this)">ğŸ›‹ï¸ Ø£Ø«Ø§Ø«</div>
            <div class="cat-item" onclick="changeCat('Ø£Ø²ÙŠØ§Ø¡', this)">ğŸ‘• Ø£Ø²ÙŠØ§Ø¡</div>
            <div class="cat-item" onclick="changeCat('Ø£Ø®Ø±Ù‰', this)">ğŸ Ø£Ø®Ø±Ù‰</div>
        </div>
        <input type="text" class="input-box" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù…Ø§ ØªØ±ÙŠØ¯..." onkeyup="searchAds(this.value)">
        <div id="ads-grid" class="ads-grid"></div>
    </div>

    <div id="add-page" class="page">
        <div class="glass-card" style="padding: 20px;">
            <h3>Ù†Ø´Ø± Ø¥Ø¹Ù„Ø§Ù† Ø¬Ø¯ÙŠØ¯</h3>
            <form id="adForm">
                <input type="file" id="p-img" class="input-box" accept="image/*" required>
                <input type="text" id="p-title" class="input-box" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†" required>
                <textarea id="p-desc" class="input-box" rows="4" placeholder="ÙˆØµÙ Ø§Ù„Ø³Ù„Ø¹Ø©..." required></textarea>
                <select id="p-cat" class="input-box">
                    <option value="Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª">Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</option>
                    <option value="Ø£Ø«Ø§Ø«">Ø£Ø«Ø§Ø«</option>
                    <option value="Ø£Ø²ÙŠØ§Ø¡">Ø£Ø²ÙŠØ§Ø¡</option>
                    <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                </select>
                <input type="number" id="p-price" class="input-box" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¨Ù€ Pi" step="0.001" required>
                <input type="tel" id="p-phone" class="input-box" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (ÙˆØ§ØªØ³Ø§Ø¨)" required>
                <button type="submit" class="main-btn">Ù†Ø´Ø± Ø§Ù„Ø¢Ù†</button>
            </form>
        </div>
    </div>

    <div id="profile-page" class="page">
        <div class="glass-card" style="padding: 20px; text-align: center; background: var(--primary); margin-bottom: 20px;">
            <div style="font-size: 50px;">ğŸ‘¤</div>
            <h3 id="user-name">--</h3>
            <p id="user-status" style="font-size: 12px; color: var(--accent);"><i class="fas fa-check-circle"></i> Ø±Ø§Ø¦Ø¯ Ù…ÙˆØ«ÙˆÙ‚</p>
        </div>
        <h4>Ø¥Ø¹Ù„Ø§Ù†Ø§ØªÙŠ</h4>
        <div id="my-ads-grid" class="ads-grid"></div>
    </div>

    <div id="chat-page" class="page">
        <h3>Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</h3>
        <div id="chat-list" class="glass-card" style="padding: 20px; text-align: center;">
            <p style="color: #64748b;">Ù‚Ø±ÙŠØ¨Ø§Ù‹: Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø¨ÙŠÙ† Ø§Ù„Ø±ÙˆØ§Ø¯</p>
        </div>
    </div>

    <nav class="tab-bar" id="nav-bar" style="display: none;">
        <button class="tab-btn active" onclick="nav('home', this)"><i class="fas fa-home"></i><span>Ø§Ù„Ø³ÙˆÙ‚</span></button>
        <button class="tab-btn" onclick="nav('chat', this)"><i class="fas fa-comment-dots"></i><span>Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</span></button>
        <button class="tab-btn" onclick="nav('add', this)"><i class="fas fa-plus-circle"></i><span>Ù†Ø´Ø±</span></button>
        <button class="tab-btn" onclick="nav('profile', this)"><i class="fas fa-user"></i><span>Ø­Ø³Ø§Ø¨ÙŠ</span></button>
    </nav>

    <script>
        // ØªÙƒÙˆÙŠÙ† Supabase
        const SUPABASE_URL = 'https://axjkwrssmofzavaoqutq.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_tiuMncgWhf1YRWoD-uYQ3Q_ziI8OKci';
        const _sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        let currentUser = null;
        let allAds = [];

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Pi SDK
        async function authPi() {
            try {
                const Pi = window.Pi;
                Pi.init({ version: "2.0" });
                const auth = await Pi.authenticate(['username', 'payments'], onIncompletePaymentFound);
                currentUser = auth.user;
                document.getElementById('user-name').innerText = currentUser.username;
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('nav-bar').style.display = 'flex';
                nav('home', document.querySelector('.tab-btn'));
                loadAds();
            } catch (err) {
                alert("ÙŠØ±Ø¬Ù‰ ÙØªØ­ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† Ù…ØªØµÙØ­ Pi Ø§Ù„Ø±Ø³Ù…ÙŠ");
            }
        }

        // Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
        function nav(pageId, btn) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId + '-page').classList.add('active');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');
            if(pageId === 'profile') loadMyAds();
            window.scrollTo(0,0);
        }

        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function loadAds() {
            const { data, error } = await _sb.from('ads').select('*').order('created_at', {ascending: false});
            if(!error) { allAds = data; renderAds(data, 'ads-grid', false); }
        }

        async function loadMyAds() {
            const { data } = await _sb.from('ads').select('*').eq('seller_username', currentUser.username);
            renderAds(data, 'my-ads-grid', true);
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
        function renderAds(data, containerId, isOwner) {
            const container = document.getElementById(containerId);
            container.innerHTML = data.map(ad => `
                <div class="ad-item glass-card">
                    <i class="far fa-heart fav-icon" onclick="toggleFav('${ad.id}')"></i>
                    <img src="${SUPABASE_URL}/storage/v1/object/public/ads-images/${ad.image_url}" onclick="viewDetail('${ad.id}')">
                    <div class="ad-details">
                        <div class="price-tag">${ad.price} Pi</div>
                        <div style="font-size:13px; font-weight:bold; white-space:nowrap; overflow:hidden;">
                            ${ad.seller_username === 'Elite' ? '<i class="fas fa-check-circle verified"></i>' : ''}${ad.title}
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-top:5px;">
                            <span style="font-size:10px; color:#94a3b8;">@${ad.seller_username}</span>
                            <span class="views-badge"><i class="far fa-eye"></i> ${ad.views_count || 0}</span>
                        </div>
                        <div style="margin-top:8px; display:flex; gap:5px;">
                            <a href="https://wa.me/${ad.phone}" style="flex:1; background:var(--glass); color:white; text-decoration:none; text-align:center; font-size:11px; padding:5px; border-radius:8px;">ÙˆØ§ØªØ³Ø§Ø¨</a>
                            ${isOwner ? `<button onclick="deleteAd('${ad.id}','${ad.image_url}')" style="background:#ef4444; border:none; color:white; border-radius:8px; padding:5px;"><i class="fas fa-trash"></i></button>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
        async function deleteAd(id, path) {
            if(confirm("Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØŸ")) {
                const { error } = await _sb.from('ads').delete().eq('id', id);
                if(!error) {
                    await _sb.storage.from('ads-images').remove([path]);
                    loadMyAds(); loadAds();
                }
            }
        }

        // Ø§Ù„ÙØ¦Ø§Øª ÙˆØ§Ù„Ø¨Ø­Ø«
        function changeCat(cat, btn) {
            document.querySelectorAll('.cat-item').forEach(i => i.classList.remove('active'));
            btn.classList.add('active');
            const filtered = cat === 'Ø§Ù„ÙƒÙ„' ? allAds : allAds.filter(a => a.category === cat);
            renderAds(filtered, 'ads-grid', false);
        }

        function searchAds(val) {
            const filtered = allAds.filter(a => a.title.toLowerCase().includes(val.toLowerCase()));
            renderAds(filtered, 'ads-grid', false);
        }

        // Ø±ÙØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†
        document.getElementById('adForm').onsubmit = async (e) => {
            e.preventDefault();
            const file = document.getElementById('p-img').files[0];
            const path = `img_${Date.now()}.png`;

            const { error: upErr } = await _sb.storage.from('ads-images').upload(path, file);
            if(upErr) return alert("Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©");

            const { error } = await _sb.from('ads').insert([{
                title: document.getElementById('p-title').value,
                description: document.getElementById('p-desc').value,
                price: document.getElementById('p-price').value,
                phone: document.getElementById('p-phone').value,
                category: document.getElementById('p-cat').value,
                image_url: path,
                seller_username: currentUser.username
            }]);

            if(!error) {
                alert("ØªÙ… Ø§Ù„Ù†Ø´Ø±!");
                document.getElementById('adForm').reset();
                nav('home');
                loadAds();
            }
        };

        function onIncompletePaymentFound(p) { console.log(p); }
        function toggleFav(id) { alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙØ¶Ù„Ø© â¤ï¸"); }
    </script>
</body>
</html>
