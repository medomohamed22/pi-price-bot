<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
  <title>Donate Way — Token & DEX Dashboard (Testnet)</title>

  <!-- Pi SDK -->
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>

  <!-- (اختياري) اربط ملف CSS بتاعك -->
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div class="app">
    <header class="top">
      <div class="brand">
        <div class="logo">DW</div>
        <div class="meta">
          <h1>Donate Way</h1>
          <p>Token + DEX + AMM + Domain Verify + Home Domain (Testnet)</p>
        </div>
      </div>

      <div class="actions">
        <button id="btnInit" class="btn ghost">Init SDK</button>
        <button id="btnAuth" class="btn primary">تسجيل دخول Pi</button>
      </div>
    </header>

    <!-- Tabs -->
    <nav class="tabs">
      <button class="tab active" data-page="dashboard">Dashboard</button>
      <button class="tab" data-page="domain">Domain Verification</button>
    </nav>

    <!-- PAGE: Dashboard -->
    <section id="page-dashboard" class="grid page active">

      <div class="card">
        <h2>حالة Pi SDK</h2>
        <div class="kv">
          <div class="k">Connected</div><div class="v" id="sdkConnected">—</div>
          <div class="k">User</div><div class="v" id="sdkUser">—</div>
          <div class="k">UID</div><div class="v mono" id="sdkUid">—</div>
          <div class="k">Access Token</div><div class="v mono" id="sdkToken">—</div>
        </div>
        <small class="muted">متخزّنش accessToken بشكل دائم على الفرونت.</small>
      </div>

      <div class="card">
        <h2>إعدادات التوكن (Pi Testnet)</h2>

        <label class="lbl">Display Name</label>
        <input id="displayName" class="inp" value="Donate Way" />

        <label class="lbl">Asset Code (1–12 Uppercase)</label>
        <input id="assetCode" class="inp mono" value="DONATEWAY" />

        <div class="row2">
          <div>
            <label class="lbl">Initial Supply</label>
            <input id="initialSupply" class="inp mono" value="1000000" />
          </div>
          <div>
            <label class="lbl">Admin Token (اختياري)</label>
            <input id="adminToken" class="inp mono" placeholder="X-Admin-Token" />
          </div>
        </div>

        <div class="btnRow">
          <button id="btnBootstrap" class="btn">1) Create/Bootstrap Token</button>
          <button id="btnSellOffer" class="btn">2) Create Sell Offer (DEX)</button>
        </div>

        <!-- ✅ NEW: Trustline on Distributor -->
        <div class="btnRow">
          <button id="btnTrustDistributor" class="btn ghost">Add Trustline (Distributor)</button>
        </div>

        <label class="lbl">Trustline Result</label>
        <pre id="trustOut" class="log"></pre>

        <div class="note">
          <b>Bootstrap</b> = Distributor Trustline + Issuer يبعث الكمية للـ Distributor.
          <div class="muted" style="margin-top:6px">
            Issuer PubKey: <span class="mono" id="issuerPub">—</span>
          </div>
          <div class="muted" style="margin-top:4px">
            Distributor PubKey: <span class="mono" id="distPub">—</span>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>DEX Sell Offer (Token/Pi)</h2>

        <div class="row2">
          <div>
            <label class="lbl">Amount (Token)</label>
            <input id="offerAmount" class="inp mono" value="10000" />
          </div>
          <div>
            <label class="lbl">Price (Pi per 1 Token)</label>
            <input id="offerPrice" class="inp mono" value="0.01" />
          </div>
        </div>

        <small class="muted">
          وجود Offer/سيولة بيساعد التوكن يظهر ويتصنّف على الدكس.
        </small>
      </div>

      <div class="card">
        <h2>AMM — Add Liquidity (Token/Pi)</h2>

        <div class="row2">
          <div>
            <label class="lbl">Token Amount</label>
            <input id="ammTokenAmount" class="inp mono" value="5000" />
          </div>
          <div>
            <label class="lbl">Pi Amount</label>
            <input id="ammPiAmount" class="inp mono" value="50" />
          </div>
        </div>

        <div class="row2">
          <div>
            <label class="lbl">Min Price Guard (اختياري)</label>
            <input id="ammMinPrice" class="inp mono" value="0.000001" />
          </div>
          <div>
            <label class="lbl">Max Price Guard (اختياري)</label>
            <input id="ammMaxPrice" class="inp mono" value="1000000" />
          </div>
        </div>

        <div class="btnRow">
          <button id="btnAddAmm" class="btn">3) Add AMM Liquidity</button>
        </div>

        <small class="muted">
          لازم الـ Distributor يكون معاه Pi (native) + Token عشان يضيف سيولة.
        </small>
      </div>

      <!-- ✅ Home domain card -->
      <div class="card">
        <h2>ربط التوكن بالدومين على السلسلة (Issuer home_domain)</h2>

        <div class="note">
          <b>مهم جدًا:</b> علشان Pi DEX يربط توكنك بـ <span class="mono">TOML</span> لازم تحط
          <span class="mono">home_domain</span> على حساب الـ Issuer (Hostname فقط).
          <div class="muted" style="margin-top:6px">
            مثال: <span class="mono">pi-links.netlify.app</span> (من غير https://)
          </div>
        </div>

        <label class="lbl">Home Domain (Hostname فقط)</label>
        <input id="hdDomain" class="inp mono" placeholder="pi-links.netlify.app" />

        <div class="btnRow">
          <button id="btnSetHomeDomain" class="btn">Set home_domain (Issuer)</button>
          <button id="btnCheckHomeDomain" class="btn primary">Check Issuer home_domain</button>
        </div>

        <label class="lbl">Result</label>
        <pre id="homeDomainOut" class="log"></pre>

        <small class="muted">
          لازم يكون عندك Functions: <span class="mono">set_home_domain.js</span> و <span class="mono">get_issuer_info.js</span>
        </small>
      </div>

      <div class="card">
        <h2>Pi Payments (تبرعات داخل التطبيق)</h2>

        <div class="row2">
          <div>
            <label class="lbl">Donation Amount (π)</label>
            <input id="donAmount" class="inp mono" value="1" />
          </div>
          <div>
            <label class="lbl">Memo</label>
            <input id="donMemo" class="inp" value="Donate Way — Donation" />
          </div>
        </div>

        <button id="btnDonate" class="btn primary">ادفع تبرع بـ Pi</button>
        <small class="muted">الـ approve/complete لازم يتموا سيرفر سايد.</small>
      </div>

      <div class="card">
        <h2>Logs</h2>
        <pre id="log" class="log"></pre>
      </div>
    </section>

    <!-- PAGE: Domain -->
    <section id="page-domain" class="grid page">
      <div class="card">
        <h2>Domain Verification — Checklist</h2>

        <ol class="checklist">
          <li>جهّز دومين + HTTPS شغال.</li>
          <li>أضف الملفات:
            <span class="mono">/.well-known/stellar.toml</span> و
            <span class="mono">/.well-known/pi.toml</span>
          </li>
          <li>تأكد إنهم بيتفتحوا 200.</li>
          <li><b>خطوة مهمة جدًا:</b> من Dashboard نفّذ
            <span class="mono">Set home_domain</span> للـ Issuer بنفس الدومين.
          </li>
          <li>اعمل Offers/AMM على زوج <span class="mono">Token/PI</span> علشان يظهر.</li>
        </ol>

        <div class="note">
          وجود TOML + home_domain + سيولة = أفضل فرصة إن التوكن يظهر في Pi Wallet/DEX.
        </div>
      </div>

      <div class="card">
        <h2>مولّد TOML (انسخه وحطه على الدومين)</h2>

        <label class="lbl">Domain</label>
        <input id="verDomain" class="inp mono" placeholder="pi-links.netlify.app" />

        <div class="row2">
          <div>
            <label class="lbl">Asset Code</label>
            <input id="verAssetCode" class="inp mono" value="DONATEWAY" />
          </div>
          <div>
            <label class="lbl">Issuer Public Key</label>
            <input id="verIssuer" class="inp mono" placeholder="G...." />
          </div>
        </div>

        <label class="lbl">Project Name</label>
        <input id="verName" class="inp" value="Donate Way" />

        <label class="lbl">Description</label>
        <input id="verDesc" class="inp" value="Donate Way token on Pi Testnet for donations." />

        <div class="btnRow">
          <button id="btnGenToml" class="btn">Generate TOML</button>
          <button id="btnCheckDomain" class="btn primary">Check Domain</button>
        </div>

        <label class="lbl">Generated TOML</label>
        <textarea id="tomlOut" class="inp mono" rows="12" readonly></textarea>

        <small class="muted">
          انسخ الناتج وحطه في:
          <span class="mono">/.well-known/stellar.toml</span>
          و <span class="mono">/.well-known/pi.toml</span>
        </small>
      </div>

      <div class="card">
        <h2>نتيجة فحص الدومين</h2>
        <pre id="domainCheckOut" class="log"></pre>
      </div>

      <div class="card">
        <h2>Logs</h2>
        <pre id="log2" class="log"></pre>
      </div>
    </section>

    <footer class="foot">
      <span class="muted">Testnet فقط — متحطّش Seeds أو API Keys في الفرونت.</span>
    </footer>
  </div>

  <script src="./app.js"></script>
</body>
</html>
