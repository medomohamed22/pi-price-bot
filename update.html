<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping - Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --p: #6d28d9; --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #fbbf24; }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; transition: 0.3s; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        
        .track-card { background: var(--card); padding: 30px; border-radius: 25px; width: 100%; max-width: 500px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; border: 1px solid rgba(255,255,255,0.1); }
        .logo { font-size: 1.5rem; font-weight: bold; margin-bottom: 20px; display: block; color: var(--text); text-decoration: none; }
        
        input { width: 100%; padding: 14px; margin: 15px 0; border-radius: 12px; border: 1px solid #334155; background: #0f172a; color: white; text-align: center; }
        .btn { background: var(--p); color: white; border: none; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-weight: bold; width: 100%; }
        
        #orderInfo { margin-top: 25px; text-align: right; display: none; border-top: 1px solid #334155; padding-top: 20px; }
        [dir="ltr"] #orderInfo { text-align: left; }
        
        .status-badge { background: var(--accent); color: #000; padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 0.9rem; }
        .item { margin-bottom: 10px; font-size: 1rem; color: #cbd5e1; }
        .item b { color: white; }
        .lang-btn { position: absolute; top: 20px; right: 20px; background: #334155; color: white; border: none; padding: 5px 15px; border-radius: 15px; cursor: pointer; }
    </style>
</head>
<body>

    <button class="lang-btn" onclick="toggleLang()">English</button>

    <div class="track-card">
        <a href="index.html" class="logo">ğŸ›’ Shopping</a>
        <h2 id="ui-title">Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h2>
        <p id="ui-desc">Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© (TXID) Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨Ùƒ</p>
        
        <input type="text" id="txidInput" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©">
        <button class="btn" id="ui-btn" onclick="trackOrder()">Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø·Ù„Ø¨</button>

        <div id="orderInfo">
            <div class="item"><span id="ui-prod">Ø§Ù„Ù…Ù†ØªØ¬:</span> <b id="res-prod">...</b></div>
            <div class="item"><span id="ui-status-label">Ø§Ù„Ø­Ø§Ù„Ø©:</span> <span class="status-badge" id="res-status">...</span></div>
            <div class="item"><span id="ui-client">Ø§Ù„Ø¹Ù…ÙŠÙ„:</span> <b id="res-client">...</b></div>
            <hr style="border: 0.5px solid #334155">
            <p id="ui-note" style="font-size: 0.8rem; color: #94a3b8;">Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ø¹Ø¨Ø± Ø§Ù„Ù‡Ø§ØªÙ Ø¹Ù†Ø¯ Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ø´Ø­Ù†.</p>
        </div>
        <div id="error-msg" style="color: #f87171; margin-top: 15px;"></div>
    </div>

    <script>
        const _supabase = supabase.createClient('https://xncapmzlwuisupkjlftb.supabase.co', 'sb_publishable_zPECXAiI_bDbeLtRYe3vIw_IEt_p_AS');
        let currentLang = 'ar';

        const dict = {
            ar: { title: "Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨", desc: "Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© (TXID) Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø·Ù„Ø¨Ùƒ", btn: "Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø·Ù„Ø¨", prod: "Ø§Ù„Ù…Ù†ØªØ¬:", status: "Ø§Ù„Ø­Ø§Ù„Ø©:", client: "Ø§Ù„Ø¹Ù…ÙŠÙ„:", note: "Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ø¹Ø¨Ø± Ø§Ù„Ù‡Ø§ØªÙ Ø¹Ù†Ø¯ Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ø´Ø­Ù†.", error: "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…", lang: "English" },
            en: { title: "Order Tracking", desc: "Enter Transaction ID (TXID) to track your order", btn: "Track Order", prod: "Product:", status: "Status:", client: "Client:", note: "We will contact you via phone once the product is shipped.", error: "Order not found with this ID", lang: "Ø¹Ø±Ø¨ÙŠ" }
        };

        function toggleLang() {
            currentLang = currentLang === 'ar' ? 'en' : 'ar';
            document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            document.querySelector('.lang-btn').innerText = dict[currentLang].lang;
            updateUI();
        }

        function updateUI() {
            const d = dict[currentLang];
            document.getElementById('ui-title').innerText = d.title;
            document.getElementById('ui-desc').innerText = d.desc;
            document.getElementById('ui-btn').innerText = d.btn;
            document.getElementById('ui-prod').innerText = d.prod;
            document.getElementById('ui-status-label').innerText = d.status;
            document.getElementById('ui-client').innerText = d.client;
            document.getElementById('ui-note').innerText = d.note;
            document.getElementById('txidInput').placeholder = (currentLang === 'ar' ? "Ø±Ù‚Ù… Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø©" : "Transaction ID");
        }

        async function trackOrder() {
            const txid = document.getElementById('txidInput').value.trim();
            const errorDiv = document.getElementById('error-msg');
            const infoDiv = document.getElementById('orderInfo');
            
            errorDiv.innerText = "";
            infoDiv.style.display = "none";

            if(!txid) return;

            const { data, error } = await _supabase
                .from('orders')
                .select('*')
                .eq('txid', txid)
                .single();

            if (error || !data) {
                errorDiv.innerText = dict[currentLang].error;
            } else {
                infoDiv.style.display = "block";
                document.getElementById('res-prod').innerText = data.product_name;
                document.getElementById('res-status').innerText = data.status || (currentLang === 'ar' ? 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' : 'Pending');
                document.getElementById('res-client').innerText = data.customer_name;
            }
        }

        // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¥Ø°Ø§ ÙˆØ¬Ø¯ TXID ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·
        window.onload = () => {
            const urlParams = new URLSearchParams(window.location.search);
            const txid = urlParams.get('txid');
            if(txid) {
                document.getElementById('txidInput').value = txid;
                trackOrder();
            }
        };
    </script>
</body>
</html>
