<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donate Way - Donate with Pi Network</title>
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f0ff 0%, #e6d9ff 100%);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            color: #4a148c;
        }

        .container { max-width: 1100px; margin: 30px auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 50px; position: relative; }
        #lang-switch {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #7e57c2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
        }
        #lang-switch:hover { background: #6a1b9a; }
        .logo { font-size: 90px; margin-bottom: 10px; color: #7e57c2; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        h1 { font-size: 38px; color: #6a1b9a; margin: 10px 0; }
        p.intro { font-size: 19px; color: #7b1fa2; opacity: 0.9; max-width: 800px; margin: 0 auto 30px; }
        #user { font-size: 23px; font-weight: bold; color: #4a148c; margin: 20px 0; }

        .campaigns { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; }

        .campaign-card {
            background: #fff;
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(126, 87, 194, 0.15);
            padding: 35px 25px;
            text-align: center;
            transition: all 0.4s ease;
            border: 1px solid rgba(126, 87, 194, 0.1);
        }
        .campaign-card:hover { transform: translateY(-15px); box-shadow: 0 20px 40px rgba(126, 87, 194, 0.25); }

        .icon { font-size: 60px; margin-bottom: 20px; color: #9c27b0; }

        .campaign-title { font-size: 26px; color: #6a1b9a; margin-bottom: 15px; font-weight: 600; }
        .campaign-desc { font-size: 16px; color: #7b1fa2; line-height: 1.7; margin-bottom: 25px; }

        .donate-options { display: flex; justify-content: center; gap: 12px; margin: 25px 0; flex-wrap: wrap; }
        .amount-btn {
            background: #ede7f6; border: 2px solid #b39ddb; color: #6a1b9a; padding: 10px 18px; font-size: 15px;
            border-radius: 50px; cursor: pointer; transition: all 0.3s ease; min-width: 75px; font-weight: 500;
        }
        .amount-btn:hover { background: #b39ddb; color: white; transform: scale(1.1); }
        .amount-btn.selected { background: #7e57c2; color: white; border-color: #7e57c2; box-shadow: 0 5px 15px rgba(126, 87, 194, 0.4); }

        .custom-amount { display: flex; justify-content: center; gap: 12px; margin: 25px 0; flex-wrap: wrap; align-items: center; }
        .custom-input {
            padding: 12px 20px; font-size: 16px; border-radius: 50px; border: 2px solid #b39ddb;
            width: 180px; text-align: center; background: white; color: #4a148c;
        }
        .custom-input::placeholder { color: #9575cd; }
        .custom-input:focus { outline: none; border-color: #7e57c2; box-shadow: 0 0 0 3px rgba(126, 87, 194, 0.2); }

        button.donate {
            background: linear-gradient(135deg, #9c27b0, #7e57c2); color: white; border: none; padding: 16px 40px;
            font-size: 18px; font-weight: bold; border-radius: 50px; cursor: pointer;
            box-shadow: 0 10px 25px rgba(126, 87, 194, 0.3); transition: all 0.4s ease;
            width: 100%; margin-top: 15px;
        }
        button.donate:hover { transform: translateY(-5px); box-shadow: 0 15px 35px rgba(126, 87, 194, 0.4); }

        .note {
            text-align: center; font-size: 15px; margin: 60px auto 0; max-width: 90%;
            color: #6a1b9a; background: rgba(255, 255, 255, 0.7); padding: 20px;
            border-radius: 20px; backdrop-filter: blur(10px); border: 1px solid rgba(126, 87, 194, 0.2);
        }
        footer { text-align: center; margin-top: 70px; font-size: 14px; color: #7b1fa2; opacity: 0.8; }

        @media (max-width: 768px) {
            .logo { font-size: 70px; } h1 { font-size: 32px; } p.intro { font-size: 17px; } #user { font-size: 21px; }
            .campaign-title { font-size: 24px; } .campaign-desc { font-size: 15px; }
            .custom-input { width: 150px; } button.donate { padding: 14px 30px; font-size: 17px; }
            #lang-switch { position: static; margin-bottom: 20px; }
        }
        @media (max-width: 480px) {
            .container { padding: 15px; } .donate-options { gap: 8px; }
            .amount-btn { padding: 8px 14px; font-size: 14px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button id="lang-switch">Switch to Arabic</button>
            <div class="logo">Ï€</div>
            <h1>Donate Way</h1>
            <p class="intro"></p>
            <div id="user"></div>
        </div>

        <div id="campaigns" class="campaigns"></div>

        <div class="note"></div>

        <footer></footer>
    </div>

    <script>
        // ØªÙ‡ÙŠØ¦Ø© Pi SDK
        Pi.init({ version: "2.0" });

        let currentLang = 'en';
        let currentUsername = null;

        // Ø§Ù„Ù†ØµÙˆØµ
        const translations = {
            en: {
                intro: "Donate with Pi Network to support charitable and humanitarian campaigns",
                userLoading: "Authenticating via Pi...",
                userGuest: "Donate as Guest",
                userGreeting: "Welcome, {name} ğŸ‘‹",
                note: "<strong>Note:</strong> You can choose a fixed amount or enter a custom amount (e.g. 0.001 or 1.5 or 999 Pi).<br>Payment is made through the official Pi wallet.",
                footer: "Donate Way Â© 2025 - Powered by Pi Network",
                customPlaceholder: "Custom amount",
                customButton: "Apply",
                donateButton: "Donate Now {amount} Pi",
                campaigns: [
                    { title: "Food Aid for Needy Families", desc: "Contribute to providing meals for families in need in affected areas.", icon: "ğŸ²" },
                    { title: "Education for Deprived Children", desc: "Support education for children in remote areas by providing books and school supplies.", icon: "ğŸ“š" },
                    { title: "Medical Treatment for Patients", desc: "Help cover treatment costs for patients who cannot afford expenses.", icon: "ğŸ¥" },
                    { title: "Clean Water Projects", desc: "Dig wells and provide clean drinking water to deprived villages.", icon: "ğŸ’§" }
                ]
            },
            ar: {
                intro: "ØªØ¨Ø±Ø¹ Ø¨Ø¹Ù…Ù„Ø© Pi Network Ù„Ø¯Ø¹Ù… Ø§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„Ø®ÙŠØ±ÙŠØ© ÙˆØ§Ù„Ø¥Ù†Ø³Ø§Ù†ÙŠØ©",
                userLoading: "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØ«ÙŠÙ‚ Ø¹Ø¨Ø± Pi...",
                userGuest: "ØªØ¨Ø±Ø¹ ÙƒØ²Ø§Ø¦Ø±",
                userGreeting: "Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ {name} ğŸ‘‹",
                note: "<strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¨Ù„Øº Ø«Ø§Ø¨Øª Ø£Ùˆ ÙƒØªØ§Ø¨Ø© Ù…Ø¨Ù„Øº Ù…Ø®ØµØµ (Ù…Ø«Ù„ 0.001 Ø£Ùˆ 1.5 Ø£Ùˆ 999 Pi).<br>Ø§Ù„Ø¯ÙØ¹ ÙŠØªÙ… Ø¹Ø¨Ø± Ù…Ø­ÙØ¸Ø© Pi Ø§Ù„Ø±Ø³Ù…ÙŠØ©.",
                footer: "Donate Way Â© 2025 - Ù…Ø¯Ø¹ÙˆÙ… Ø¨ØªÙ‚Ù†ÙŠØ© Pi Network",
                customPlaceholder: "Ù…Ø¨Ù„Øº Ù…Ø®ØµØµ",
                customButton: "ØªÙØ¹ÙŠÙ„",
                donateButton: "ØªØ¨Ø±Ø¹ Ø§Ù„Ø¢Ù† Ø¨Ù€ {amount} Pi",
                campaigns: [
                    { title: "Ù…Ø³Ø§Ø¹Ø¯Ø© ØºØ°Ø§Ø¦ÙŠØ© Ù„Ù„Ø£Ø³Ø± Ø§Ù„ÙÙ‚ÙŠØ±Ø©", desc: "Ø³Ø§Ù‡Ù… ÙÙŠ ØªÙˆÙÙŠØ± ÙˆØ¬Ø¨Ø§Øª ØºØ°Ø§Ø¦ÙŠØ© Ù„Ù„Ø¹Ø§Ø¦Ù„Ø§Øª Ø§Ù„Ù…Ø­ØªØ§Ø¬Ø© ÙÙŠ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…ØªØ¶Ø±Ø±Ø©.", icon: "ğŸ²" },
                    { title: "ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø£Ø·ÙØ§Ù„ Ø§Ù„Ù…Ø­Ø±ÙˆÙ…ÙŠÙ†", desc: "Ø¯Ø¹Ù… ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø£Ø·ÙØ§Ù„ ÙÙŠ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù†Ø§Ø¦ÙŠØ© Ù…Ù† Ø®Ù„Ø§Ù„ ØªÙˆÙÙŠØ± Ø§Ù„ÙƒØªØ¨ ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©.", icon: "ğŸ“š" },
                    { title: "Ø¹Ù„Ø§Ø¬ Ø·Ø¨ÙŠ Ù„Ù„Ù…Ø±Ø¶Ù‰", desc: "Ù…Ø³Ø§Ø¹Ø¯Ø© ÙÙŠ ØªØºØ·ÙŠØ© ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ø¹Ù„Ø§Ø¬ Ù„Ù„Ù…Ø±Ø¶Ù‰ ØºÙŠØ± Ø§Ù„Ù‚Ø§Ø¯Ø±ÙŠÙ† Ø¹Ù„Ù‰ ØªØ­Ù…Ù„ Ø§Ù„Ù†ÙÙ‚Ø§Øª.", icon: "ğŸ¥" },
                    { title: "Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…ÙŠØ§Ù‡ Ù†Ø¸ÙŠÙØ©", desc: "Ø­ÙØ± Ø¢Ø¨Ø§Ø± ÙˆØªÙˆÙÙŠØ± Ù…ÙŠØ§Ù‡ Ø´Ø±Ø¨ Ù†Ø¸ÙŠÙØ© Ù„Ù„Ù‚Ø±Ù‰ Ø§Ù„Ù…Ø­Ø±ÙˆÙ…Ø©.", icon: "ğŸ’§" }
                ]
            }
        };

        // ÙƒØ´Ù Ø§Ù„Ù„ØºØ© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        const userLang = (navigator.language || navigator.userLanguage || 'en').substr(0, 2);
        currentLang = userLang === 'ar' ? 'ar' : 'en';
        document.documentElement.lang = currentLang;
        document.documentElement.dir = currentLang === 'en' ? 'ltr' : 'rtl';
        document.getElementById('lang-switch').textContent = currentLang === 'en' ? 'Switch to Arabic' : 'ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©';

        const t = translations[currentLang];

        let selectedAmounts = {};

        // ØªØ­Ø¯ÙŠØ« ØªØ­ÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙˆØ±Ø§Ù‹ (Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØ«ÙŠÙ‚)
        document.getElementById('user').textContent = t.userLoading;

        function updateUserGreeting() {
            const greeting = document.getElementById('user');
            if (currentUsername) {
                greeting.textContent = t.userGreeting.replace('{name}', currentUsername);
            } else {
                greeting.textContent = t.userGuest;
            }
        }

        function updateDonateButton(card, amount) {
            const btn = card.querySelector('.donate');
            const safeAmount = amount || 10;
            btn.textContent = t.donateButton.replace('{amount}', safeAmount);
        }

        // Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙˆØ± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        async function authenticateOnLoad() {
            try {
                // Ù†Ø­Ø§ÙˆÙ„ Ù†Ø£Ø®Ø¯ username Ø¨Ø¯ÙˆÙ† prompt Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯ (ÙÙŠ Pi Browser Ø¨ÙŠØ´ØªØºÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ)
                const user = await Pi.authenticate(['username']);
                currentUsername = user.username || null;
                updateUserGreeting();
            } catch (err) {
                // Ù„Ùˆ ÙØ´Ù„ Ø£Ùˆ Ø±ÙØ¶ØŒ Ù†Ø¨Ù‚Ù‰ Ø¹Ù„Ù‰ "ØªØ¨Ø±Ø¹ ÙƒØ²Ø§Ø¦Ø±"
                console.log('ØªØ¹Ø±Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙØ´Ù„ (Ø·Ø¨ÙŠØ¹ÙŠ Ù„Ùˆ Ù…Ø´ ÙÙŠ Pi Browser):', err);
                updateUserGreeting();
            }
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©
        document.getElementById('lang-switch').addEventListener('click', () => {
            currentLang = currentLang === 'en' ? 'ar' : 'en';
            document.documentElement.lang = currentLang;
            document.documentElement.dir = currentLang === 'en' ? 'ltr' : 'rtl';
            document.getElementById('lang-switch').textContent = currentLang === 'en' ? 'Switch to Arabic' : 'ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©';

            updateTexts();
            updateAllDonateButtons();
            updateUserGreeting();
        });

        function updateTexts() {
            document.querySelector('p.intro').textContent = translations[currentLang].intro;
            document.querySelector('.note').innerHTML = translations[currentLang].note;
            document.querySelector('footer').textContent = translations[currentLang].footer;

            document.querySelectorAll('.campaign-title').forEach((el, i) => el.textContent = translations[currentLang].campaigns[i].title);
            document.querySelectorAll('.campaign-desc').forEach((el, i) => el.textContent = translations[currentLang].campaigns[i].desc);
            document.querySelectorAll('.custom-input').forEach(input => input.placeholder = translations[currentLang].customPlaceholder);
            document.querySelectorAll('.custom-btn').forEach(btn => btn.textContent = translations[currentLang].customButton);
        }

        function updateAllDonateButtons() {
            document.querySelectorAll('.campaign-card').forEach(card => {
                const id = card.dataset.id;
                const amount = selectedAmounts[id] || 10;
                updateDonateButton(card, amount);
            });
        }

        window.onload = function() {
            updateTexts();

            const container = document.getElementById('campaigns');
            translations[currentLang].campaigns.forEach((camp, index) => {
                const id = `camp-${index}`;
                selectedAmounts[id] = 10;

                const card = document.createElement('div');
                card.className = 'campaign-card';
                card.dataset.id = id;
                card.innerHTML = `
                    <div class="icon">${camp.icon}</div>
                    <h2 class="campaign-title">${camp.title}</h2>
                    <p class="campaign-desc">${camp.desc}</p>
                    
                    <div class="donate-options">
                        <button class="amount-btn selected" data-amount="5">5 Pi</button>
                        <button class="amount-btn" data-amount="10">10 Pi</button>
                        <button class="amount-btn" data-amount="50">50 Pi</button>
                        <button class="amount-btn" data-amount="100">100 Pi</button>
                    </div>
                    
                    <div class="custom-amount">
                        <input type="number" step="0.001" min="0.001" class="custom-input" placeholder="${translations[currentLang].customPlaceholder}">
                        <button class="amount-btn custom-btn">${translations[currentLang].customButton}</button>
                    </div>
                    
                    <button class="donate">${t.donateButton.replace('{amount}', '10')}</button>
                `;
                container.appendChild(card);

                // Events
                card.querySelectorAll('.amount-btn[data-amount]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        card.querySelectorAll('.amount-btn[data-amount]').forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                        selectedAmounts[id] = parseFloat(btn.dataset.amount);
                        updateDonateButton(card, selectedAmounts[id]);
                        card.querySelector('.custom-input').value = '';
                    });
                });

                const customBtn = card.querySelector('.custom-btn');
                const customInput = card.querySelector('.custom-input');
                customBtn.addEventListener('click', () => {
                    const val = parseFloat(customInput.value);
                    if (val > 0) {
                        selectedAmounts[id] = val;
                        card.querySelectorAll('.amount-btn[data-amount]').forEach(b => b.classList.remove('selected'));
                        updateDonateButton(card, val);
                    }
                });

                card.querySelector('.donate').addEventListener('click', async () => {
                    const amount = selectedAmounts[id];
                    if (!amount || amount <= 0) {
                        alert(currentLang === 'en' ? 'Choose a valid amount' : 'Ø§Ø®ØªØ± Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­');
                        return;
                    }

                    try {
                        const scopes = currentUsername ? ['payments'] : ['username', 'payments'];
                        const user = await Pi.authenticate(scopes, onIncompletePaymentFound);
                        if (user.username && user.username !== currentUsername) {
                            currentUsername = user.username;
                            updateUserGreeting();
                        }

                        const paymentData = {
                            amount,
                            memo: `${camp.title} - ${amount} Pi donation from ${user.username || 'Guest'} â¤ï¸`,
                            metadata: { campaign: camp.title, donor: user.uid }
                        };

                        const callbacks = {
                            onReadyForServerApproval: async (paymentId) => {
                                await fetch('/api/pi/approve', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ paymentId }) });
                            },
                            onReadyForServerCompletion: async (paymentId, txid) => {
                                await fetch('/api/pi/complete', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ paymentId, txid }) });
                                alert(currentLang === 'en' ? `Success! TXID: ${txid}` : `Ù†Ø¬Ø­ Ø§Ù„Ø¯ÙØ¹! TXID: ${txid}`);
                            },
                            onCancel: () => alert(currentLang === 'en' ? 'Cancelled' : 'ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡'),
                            onError: (err) => alert('Error: ' + err.message)
                        };

                        Pi.createPayment(paymentData, callbacks);
                    } catch (err) {
                        alert('Error: ' + err.message);
                    }
                });
            });

            // Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³Ù… ÙÙˆØ± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
            authenticateOnLoad();
        };

        function onIncompletePaymentFound(payment) {
            console.log("Incomplete payment:", payment);
        }
    </script>
</body>
</html>
