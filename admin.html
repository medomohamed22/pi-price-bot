<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Shopping Admin</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #f1f5f9; margin: 0; padding: 20px; color: #1e293b; }
        .admin-container { max-width: 1100px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 30px; }
        h2 { border-bottom: 2px solid #6d28d9; padding-bottom: 10px; color: #6d28d9; }
        
        /* Form Styling */
        .form-group { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        input { padding: 12px; border: 1px solid #cbd5e1; border-radius: 8px; }
        .btn-save { background: #6d28d9; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; }

        /* Tables Styling */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; }
        th, td { padding: 12px; text-align: right; border-bottom: 1px solid #e2e8f0; font-size: 0.9rem; }
        th { background: #f8fafc; color: #64748b; }
        
        .status-select { padding: 5px; border-radius: 5px; border: 1px solid #cbd5e1; background: #fff; }
        .btn-update { background: #22c55e; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.8rem; }
        .badge { padding: 4px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: bold; background: #fbbf24; }
    </style>
</head>
<body>

    <div class="admin-container">
        <h1>ğŸ›  Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªØ¬Ø±</h1>

        <div class="card">
            <h2>ğŸ“¦ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>
            <div class="form-group">
                <input type="text" id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
                <input type="number" id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¨Ù€ Pi">
                <input type="text" id="pImg" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©">
            </div>
            <button class="btn-save" onclick="addProduct()">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬ ÙÙŠ Ø§Ù„Ù…ØªØ¬Ø±</button>
        </div>

        <div class="card">
            <h2>ğŸ›’ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h2>
            <div style="overflow-x: auto;">
                <table id="ordersTable">
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                            <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                            <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                            <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (TXID)</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const SB_URL = 'https://xncapmzlwuisupkjlftb.supabase.co';
        const SB_KEY = 'sb_publishable_zPECXAiI_bDbeLtRYe3vIw_IEt_p_AS';
        const _supabase = supabase.createClient(SB_URL, SB_KEY);

        // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
        async function addProduct() {
            const name = document.getElementById('pName').value;
            const price = document.getElementById('pPrice').value;
            const img = document.getElementById('pImg').value;
            if(!name || !price || !img) return alert("Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

            await _supabase.from('products').insert([{ name, price: parseFloat(price), image_url: img }]);
            alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©!");
            location.reload();
        }

        // Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²
        async function loadOrders() {
            const { data, error } = await _supabase
                .from('orders')
                .select('*')
                .order('created_at', { ascending: false });

            const tbody = document.querySelector('#ordersTable tbody');
            tbody.innerHTML = data.map(o => `
                <tr>
                    <td><b>${o.customer_name}</b><br><small>${o.pi_user}</small></td>
                    <td>${o.product_name}<br><small>${o.amount} Pi</small></td>
                    <td>${o.customer_phone}</td>
                    <td>${o.address}</td>
                    <td><small>${o.txid.substring(0,8)}...</small></td>
                    <td>
                        <select id="status-${o.id}" class="status-select">
                            <option value="Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©" ${o.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' ? 'selected' : ''}>Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                            <option value="ØªÙ… Ø§Ù„Ø´Ø­Ù†" ${o.status === 'ØªÙ… Ø§Ù„Ø´Ø­Ù†' ? 'selected' : ''}>ØªÙ… Ø§Ù„Ø´Ø­Ù†</option>
                            <option value="ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„" ${o.status === 'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„' ? 'selected' : ''}>ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</option>
                            <option value="Ù…Ù„ØºÙŠ" ${o.status === 'Ù…Ù„ØºÙŠ' ? 'selected' : ''}>Ù…Ù„ØºÙŠ</option>
                        </select>
                    </td>
                    <td>
                        <button class="btn-update" onclick="updateOrderStatus(${o.id})">ØªØ­Ø¯ÙŠØ«</button>
                    </td>
                </tr>
            `).join('');
        }

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ù„ÙƒÙŠ ÙŠØ±Ø§Ù‡Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ ØµÙØ­Ø© Ø§Ù„ØªØªØ¨Ø¹
        async function updateOrderStatus(orderId) {
            const newStatus = document.getElementById(`status-${orderId}`).value;
            const { error } = await _supabase
                .from('orders')
                .update({ status: newStatus })
                .eq('id', orderId);

            if (error) alert("Ø­Ø¯Ø« Ø®Ø·Ø£");
            else alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­!");
        }

        window.onload = loadOrders;
    </script>
</body>
</html>
