<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Donate Way</title>
<script src="https://sdk.minepi.com/pi-sdk.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg,#f5f0ff,#e6d9ff);
    margin:0;
    color:#4a148c;
}
.container { max-width:1100px;margin:30px auto;padding:20px; }
.header { text-align:center; position:relative; }
.logo { font-size:80px;color:#7e57c2 }
#user { margin-top:15px;font-size:22px;font-weight:bold }
.campaigns { display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:25px;margin-top:40px }
.campaign-card {
    background:#fff;border-radius:20px;padding:25px;text-align:center;
    box-shadow:0 10px 25px rgba(0,0,0,.1)
}
.amount-btn {
    padding:8px 14px;border-radius:50px;border:1px solid #b39ddb;
    cursor:pointer;background:#ede7f6;margin:4px
}
.amount-btn.selected { background:#7e57c2;color:#fff }
.custom-input { width:150px;padding:8px;border-radius:50px;border:1px solid #b39ddb }
.donate {
    margin-top:15px;width:100%;padding:14px;
    background:linear-gradient(135deg,#9c27b0,#7e57c2);
    color:white;border:none;border-radius:50px;font-size:17px;cursor:pointer
}
</style>
</head>

<body>
<div class="container">
    <div class="header">
        <div class="logo">Ï€</div>
        <h1>Donate Way</h1>
        <p>Donate using Pi Network</p>
        <div id="user">Donate as Guest</div>
    </div>

    <div id="campaigns" class="campaigns"></div>
</div>

<script>
Pi.init({ version:"2.0" });

let currentUsername = null;
let selectedAmounts = {};

const campaigns = [
    { title:"Food Aid", desc:"Provide meals", icon:"ðŸ²" },
    { title:"Education", desc:"Support learning", icon:"ðŸ“š" },
    { title:"Medical Help", desc:"Support patients", icon:"ðŸ¥" },
    { title:"Clean Water", desc:"Provide water", icon:"ðŸ’§" }
];

// 1ï¸âƒ£ Ø§Ù„ØµÙØ­Ø© ØªØ´ØªØºÙ„ ÙÙˆØ±Ù‹Ø§ ÙƒØ¶ÙŠÙ
document.getElementById("user").textContent = "Donate as Guest";

// 2ï¸âƒ£ Ù†Ø­Ø§ÙˆÙ„ Ù†ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© (Ù…Ù† ØºÙŠØ± Ù…Ø§ Ù†ÙˆÙ‚Ù Ø­Ø§Ø¬Ø©)
(async function detectUser(){
    try {
        const user = await Pi.authenticate(['username']);
        if(user?.username){
            currentUsername = user.username;
            document.getElementById("user").textContent =
                `Welcome, ${currentUsername} ðŸ‘‹`;
        }
    } catch(e){
        // Ø¹Ø§Ø¯ÙŠ Ø¬Ø¯Ù‹Ø§ â€“ ÙŠÙØ¶Ù„ Ø¶ÙŠÙ
        console.log("Guest mode");
    }
})();

// 3ï¸âƒ£ Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙƒØ±ÙˆØª
const container = document.getElementById("campaigns");

campaigns.forEach((c,i)=>{
    selectedAmounts[i]=10;

    const card = document.createElement("div");
    card.className="campaign-card";

    card.innerHTML=`
        <div style="font-size:50px">${c.icon}</div>
        <h2>${c.title}</h2>
        <p>${c.desc}</p>

        <div>
            ${[5,10,50,100].map(v=>`
                <button class="amount-btn ${v===10?'selected':''}" data-v="${v}">
                    ${v} Pi
                </button>
            `).join("")}
        </div>

        <div style="margin-top:10px">
            <input type="number" class="custom-input" placeholder="Custom amount">
            <button class="amount-btn custom-btn">Apply</button>
        </div>

        <button class="donate">Donate 10 Pi</button>
    `;

    container.appendChild(card);

    // Ø§Ø®ØªÙŠØ§Ø± Ù…Ø¨Ù„Øº
    card.querySelectorAll(".amount-btn[data-v]").forEach(btn=>{
        btn.onclick=()=>{
            card.querySelectorAll(".amount-btn[data-v]").forEach(b=>b.classList.remove("selected"));
            btn.classList.add("selected");
            selectedAmounts[i]=btn.dataset.v;
            card.querySelector(".donate").textContent=`Donate ${selectedAmounts[i]} Pi`;
        };
    });

    // Ù…Ø¨Ù„Øº Ù…Ø®ØµØµ
    card.querySelector(".custom-btn").onclick=()=>{
        const v=parseFloat(card.querySelector(".custom-input").value);
        if(v>0){
            selectedAmounts[i]=v;
            card.querySelector(".donate").textContent=`Donate ${v} Pi`;
        }
    };

    // Ø§Ù„ØªØ¨Ø±Ø¹ (Ø¯Ø§ÙŠÙ…Ù‹Ø§ Ø´ØºØ§Ù„)
    card.querySelector(".donate").onclick=async()=>{
        try{
            const user = await Pi.authenticate(['payments','username']);
            const amount = selectedAmounts[i];

            Pi.createPayment({
                amount,
                memo:`${c.title} donation`,
                metadata:{
                    donor: user?.username || "Guest"
                }
            },{
                onReadyForServerApproval:()=>{},
                onReadyForServerCompletion:(_,txid)=>{
                    alert("Payment Success âœ…\nTXID: "+txid);
                },
                onCancel:()=>alert("Cancelled"),
                onError:e=>alert(e.message)
            });

        }catch(e){
            alert("Payment failed");
        }
    };
});
</script>
</body>
</html>
