<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pi Donate</title>
<script src="https://sdk.minepi.com/pi-sdk.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 40px; background: #f5f5f5; text-align:center; }
  input { padding:10px; width:200px; border-radius:10px; border:1px solid #ccc; margin-bottom:10px; }
  button { padding:10px 20px; border:none; border-radius:10px; background:#8e44ad; color:white; cursor:pointer; font-weight:bold; }
  #log { margin-top:20px; white-space:pre-wrap; text-align:left; max-width:600px; margin-left:auto; margin-right:auto; background:white; padding:15px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
</style>
</head>
<body>

<h2>ØªØ¨Ø±Ø¹ Ø¨ÙˆØ§Ø³Ø·Ø© Pi Network</h2>
<input type="number" id="amount" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ù€ Ï€" />
<br>
<button onclick="startDonation()">ØªØ¨Ø±Ø¹ Ø§Ù„Ø¢Ù†</button>

<div id="log"></div>

<script>
  Pi.init({version:"2.0"});

  function log(msg) {
    const logDiv = document.getElementById('log');
    logDiv.innerText += msg + "\n";
  }

  async function startDonation() {
    const amount = parseFloat(document.getElementById('amount').value);
    if(!amount || amount <= 0) { alert("Ø§Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­"); return; }

    log("ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...");
    try {
      const auth = await Pi.authenticate(['username','payments'], (p)=>{});
      const user = auth.user;
      log(`âœ… Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.username}`);

      log(`ğŸ’° Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¯ÙØ¹ Ø¨Ù…Ø¨Ù„Øº: ${amount} Ï€...`);
      const payment = await Pi.createPayment({
        amount: amount,
        memo: "ØªØ¨Ø±Ø¹ Ù…Ø¨Ø§Ø´Ø± Ø¹Ø¨Ø± Ø§Ù„Ù…ØªØµÙØ­",
        metadata: { app: "DonateWayDemo" }
      });

      log(`ğŸ†” Payment ID ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡: ${payment.id}`);

      log("â³ Ø§Ù†ØªØ¸Ø§Ø± approve Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±...");
      const approveResp = await fetch('/api/pi/approve', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ paymentId: payment.id })
      }).then(r=>r.json());

      log("âœ… Ø±Ø¯ Ø§Ù„Ù€ Approve: " + JSON.stringify(approveResp));

      log("â³ Ø§Ù†ØªØ¸Ø§Ø± complete Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±...");
      const completeResp = await fetch('/api/pi/complete', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ paymentId: payment.id, txid: payment.transaction })
      }).then(r=>r.json());

      log("âœ… Ø±Ø¯ Ø§Ù„Ù€ Complete: " + JSON.stringify(completeResp));
      log("ğŸ‰ ØªÙ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­!");

    } catch(e) {
      log("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: " + e.message);
    }
  }
</script>

</body>
</html>
