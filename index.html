<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
  <title>Donate Way — Token / DEX / AMM Dashboard (Pi Testnet)</title>

  <script src="https://sdk.minepi.com/pi-sdk.js"></script>

  <style>
    :root{
      --bg:#0b0b14;
      --card:rgba(255,255,255,.08);
      --card2:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.14);
      --text:#fff;
      --muted:rgba(255,255,255,.72);
      --primary:#7f5cff;
      --primary2:#a78bfa;
      --good:#22c55e;
      --bad:#ef4444;
      --warn:#f59e0b;
      --shadow: 0 16px 40px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1000px 500px at 20% -10%, rgba(127,92,255,.35), transparent 60%),
        radial-gradient(800px 500px at 100% 20%, rgba(167,139,250,.25), transparent 55%),
        linear-gradient(180deg, #070712, #0b0b14 40%, #070712);
      padding:14px;
    }
    .wrap{max-width:1100px;margin:0 auto;display:flex;flex-direction:column;gap:12px}

    .top{
      padding:14px;
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
    }
    .brand{display:flex;align-items:center;gap:10px}
    .logo{
      width:44px;height:44px;border-radius:14px;border:1px solid var(--stroke);
      background:rgba(255,255,255,.08); overflow:hidden; display:grid; place-items:center;
    }
    .logo img{width:100%;height:100%;object-fit:cover}
    .title{display:flex;flex-direction:column;gap:2px}
    .title b{font-size:15px}
    .title span{font-size:12px;color:var(--muted)}

    .tabs{
      display:flex;gap:8px;flex-wrap:wrap;
      padding:10px;border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);border-radius:var(--radius);
    }
    .tab{
      border:1px solid var(--stroke);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;border-radius:14px;font-size:13px;cursor:pointer;
      transition:.15s; user-select:none;
    }
    .tab.active{
      background:linear-gradient(135deg, rgba(127,92,255,.35), rgba(255,255,255,.08));
      border-color:rgba(127,92,255,.55);
    }

    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:980px){.grid{grid-template-columns:1.2fr .8fr}}
    .grid2{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:980px){.grid2{grid-template-columns:1fr 1fr}}

    .card{
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.05));
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .hd{
      padding:12px 12px 10px;border-bottom:1px solid rgba(255,255,255,.10);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .hd b{font-size:14px}
    .hd span{font-size:12px;color:var(--muted)}
    .bd{padding:12px;display:flex;flex-direction:column;gap:10px}

    .row{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:720px){.row{grid-template-columns:1fr 1fr}}

    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    input, textarea, select{
      width:100%; padding:12px;
      border-radius:14px; border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.20); color:var(--text); outline:none;
    }
    textarea{min-height:130px;resize:vertical}

    .btns{display:flex;gap:8px;flex-wrap:wrap}
    button{
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.07);
      color:var(--text);
      padding:11px 12px;border-radius:14px;cursor:pointer;transition:.15s;font-size:13px;
    }
    button.primary{
      background:linear-gradient(135deg, rgba(127,92,255,.9), rgba(167,139,250,.65));
      border-color:rgba(127,92,255,.75);
    }
    button:hover{transform:translateY(-1px)}
    .pill{
      padding:6px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      font-size:12px;color:var(--muted);
      display:inline-flex;gap:8px;align-items:center;
    }
    .dot{width:8px;height:8px;border-radius:999px;background:var(--warn)}
    .dot.good{background:var(--good)}
    .dot.bad{background:var(--bad)}

    pre{
      margin:0; padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.25); overflow:auto; color:rgba(255,255,255,.92);
      font-size:12px; line-height:1.45; white-space:pre-wrap; word-break:break-word;
    }

    .page{display:none}
    .page.active{display:block}
    .muted{color:var(--muted);font-size:12px;line-height:1.6}
    .warn{color:#ffd08a}
    .goodtxt{color:#7CFFB0}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo">
          <img src="/token_256.png" onerror="this.src='/token.png'" alt="DW">
        </div>
        <div class="title">
          <b>Donate Way — Dashboard</b>
          <span>Pi Testnet — Token / DEX / AMM / Domain</span>
        </div>
      </div>

      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
        <div class="pill"><span class="dot" id="dotSdk"></span> SDK: <span id="sdkConnected">—</span></div>
        <div class="pill">User: <span id="sdkUser">—</span></div>
        <button class="primary" id="btnInit">Init SDK</button>
        <button id="btnAuth">Login</button>
      </div>
    </div>

    <div class="tabs">
      <div class="tab active" data-page="dash">Dashboard</div>
      <div class="tab" data-page="market">Market Explorer</div>
      <div class="tab" data-page="ops">Token Ops</div>
      <div class="tab" data-page="domain">Domain Verification</div>
    </div>

    <!-- DASH -->
    <div class="page active" id="page-dash">
      <div class="grid">
        <div class="card">
          <div class="hd"><b>Quick Status</b><span>Issuer / Distributor / Asset</span></div>
          <div class="bd">
            <div class="row">
              <div>
                <label>Asset Code</label>
                <input id="assetCode" value="DONATEWAY" />
              </div>
              <div>
                <label>Issuer Public Key</label>
                <input id="issuerPub" placeholder="GBQ3H..." />
              </div>
            </div>
            <div class="row">
              <div>
                <label>Distributor Public Key</label>
                <input id="distPub" placeholder="GCLLM..." />
              </div>
              <div>
                <label>Admin Token (اختياري)</label>
                <input id="adminToken" placeholder="ADMIN_TOKEN" />
              </div>
            </div>

            <div class="btns">
              <button id="btnSaveKeys">Save Keys (local)</button>
              <button class="primary" id="btnLoadAsset">Load Asset From Horizon</button>
            </div>

            <pre id="assetOut"></pre>
            <div class="muted">لو التوكن موجود في Horizon يبقى mint تمام ✅</div>
          </div>
        </div>

        <div class="card">
          <div class="hd"><b>Pi Payments (Donate)</b><span>Pi SDK</span></div>
          <div class="bd">
            <div class="row">
              <div>
                <label>Amount (π)</label>
                <input id="donAmount" value="1" />
              </div>
              <div>
                <label>Memo</label>
                <input id="donMemo" value="Donate Way — Donation" />
              </div>
            </div>
            <div class="btns">
              <button class="primary" id="btnDonate">Donate</button>
            </div>
            <pre id="payLog"></pre>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="hd"><b>Logs</b><span>frontend</span></div>
        <div class="bd">
          <pre id="log"></pre>
        </div>
      </div>
    </div>

    <!-- MARKET -->
    <div class="page" id="page-market">
      <div class="grid2">
        <div class="card">
          <div class="hd"><b>Show My Offers</b><span>Horizon: /accounts/{id}/offers</span></div>
          <div class="bd">
            <label>Account (افتراضي: Distributor)</label>
            <input id="offersAccount" placeholder="G..." />
            <div class="btns">
              <button class="primary" id="btnShowOffers">Show Offers</button>
            </div>
            <pre id="offersOut"></pre>
          </div>
        </div>

        <div class="card">
          <div class="hd"><b>Orderbook</b><span>PI ↔ DONATEWAY</span></div>
          <div class="bd">
            <div class="row">
              <div>
                <label>Mode</label>
                <select id="obMode">
                  <option value="sell_token">Selling DONATEWAY (asks)</option>
                  <option value="buy_token">Buying DONATEWAY (bids)</option>
                </select>
              </div>
              <div>
                <label>Limit</label>
                <input id="obLimit" value="20" />
              </div>
            </div>
            <div class="btns">
              <button class="primary" id="btnOrderbook">Load Orderbook</button>
            </div>
            <pre id="orderbookOut"></pre>
          </div>
        </div>

        <div class="card">
          <div class="hd"><b>Recent Trades</b><span>Horizon: /trades</span></div>
          <div class="bd">
            <div class="row">
              <div>
                <label>Limit</label>
                <input id="trLimit" value="20" />
              </div>
              <div>
                <label>Order</label>
                <select id="trOrder">
                  <option value="desc">Newest</option>
                  <option value="asc">Oldest</option>
                </select>
              </div>
            </div>
            <div class="btns">
              <button class="primary" id="btnTrades">Load Trades</button>
            </div>
            <pre id="tradesOut"></pre>
          </div>
        </div>

        <div class="card">
          <div class="hd"><b>AMM Liquidity Pool</b><span>Find pool by reserves</span></div>
          <div class="bd">
            <div class="btns">
              <button class="primary" id="btnPoolInfo">Load Pool Info</button>
            </div>
            <pre id="poolOut"></pre>
          </div>
        </div>

        <div class="card" style="grid-column:1/-1">
          <div class="hd"><b>Execute Tiny Trade (Real Activity)</b><span>Server: pathPaymentStrictSend</span></div>
          <div class="bd">
            <div class="row">
              <div>
                <label>Destination (Your Wallet G... must trust DONATEWAY)</label>
                <input id="tinyDest" placeholder="G..." />
              </div>
              <div>
                <label>Send PI Amount (tiny)</label>
                <input id="tinySendPi" value="0.1" />
              </div>
            </div>
            <div class="row">
              <div>
                <label>Dest Min Token Out (optional)</label>
                <input id="tinyMinOut" placeholder="0 (default)" />
              </div>
              <div>
                <label>Memo (optional)</label>
                <input id="tinyMemo" value="DW tiny trade" />
              </div>
            </div>
            <div class="btns">
              <button class="primary" id="btnTinyTrade">Execute Tiny Trade</button>
            </div>
            <pre id="tinyOut"></pre>
            <div class="muted warn">
              ده بيعمل صفقة فعلية (Trade) لو فيه Path في AMM/Orderbook.
              لو فشل غالبًا: مفيش path أو destination مش عامل trustline.
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="hd"><b>Market Logs</b><span>frontend</span></div>
        <div class="bd">
          <pre id="marketLog"></pre>
        </div>
      </div>
    </div>

    <!-- OPS -->
    <div class="page" id="page-ops">
      <div class="grid2">
        <div class="card">
          <div class="hd"><b>Bootstrap Token</b><span>Netlify Function</span></div>
          <div class="bd">
            <div class="row">
              <div>
                <label>Display Name</label>
                <input id="displayName" value="Donate Way" />
              </div>
              <div>
                <label>Initial Supply</label>
                <input id="initialSupply" value="1000000" />
              </div>
            </div>
            <div class="btns">
              <button class="primary" id="btnBootstrap">Bootstrap</button>
            </div>
            <pre id="bootOut"></pre>
          </div>
        </div>

        <div class="card">
          <div class="hd"><b>DEX Offers</b><span>Sell / Buy via Functions</span></div>
          <div class="bd">
            <div class="row">
              <div>
                <label>Amount (Token)</label>
                <input id="dexAmount" value="1" />
              </div>
              <div>
                <label>Price (PI per token)</label>
                <input id="dexPrice" value="0.000001" />
              </div>
            </div>
            <div class="row">
              <div>
                <label>OfferId (0=new)</label>
                <input id="dexOfferId" value="0" />
              </div>
              <div>
                <label>—</label>
                <div class="btns">
                  <button id="btnSellOffer">Sell Offer</button>
                  <button class="primary" id="btnBuyOffer">Buy Offer</button>
                </div>
              </div>
            </div>
            <pre id="dexOut"></pre>
          </div>
        </div>

        <div class="card" style="grid-column:1/-1">
          <div class="hd"><b>AMM Add Liquidity</b><span>Netlify Function</span></div>
          <div class="bd">
            <div class="row">
              <div>
                <label>Token Amount</label>
                <input id="ammTokenAmount" value="5000" />
              </div>
              <div>
                <label>PI Amount</label>
                <input id="ammPiAmount" value="50" />
              </div>
            </div>
            <div class="row">
              <div>
                <label>Min Price (optional)</label>
                <input id="ammMinPrice" placeholder="0.0000005" />
              </div>
              <div>
                <label>Max Price (optional)</label>
                <input id="ammMaxPrice" placeholder="0.00001" />
              </div>
            </div>
            <div class="btns">
              <button class="primary" id="btnAddAmm">Add Liquidity</button>
            </div>
            <pre id="ammOut"></pre>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="hd"><b>Ops Logs</b><span>frontend</span></div>
        <div class="bd">
          <pre id="opsLog"></pre>
        </div>
      </div>
    </div>

    <!-- DOMAIN -->
    <div class="page" id="page-domain">
      <div class="grid2">
        <div class="card">
          <div class="hd"><b>Generate pi.toml</b><span>with DOCUMENTATION + image</span></div>
          <div class="bd">
            <div class="row">
              <div>
                <label>Domain</label>
                <input id="verDomain" value="pi-links.netlify.app" />
              </div>
              <div>
                <label>Issuer Public Key</label>
                <input id="verIssuer" placeholder="GBQ3..." />
              </div>
            </div>
            <div class="row">
              <div>
                <label>Asset Code</label>
                <input id="verAssetCode" value="DONATEWAY" />
              </div>
              <div>
                <label>Image URL</label>
                <input id="verImage" value="https://pi-links.netlify.app/token_512.png" />
              </div>
            </div>
            <div class="row">
              <div>
                <label>Org Name</label>
                <input id="verOrgName" value="Donate Way" />
              </div>
              <div>
                <label>Org URL</label>
                <input id="verOrgUrl" value="https://pi-links.netlify.app" />
              </div>
            </div>
            <label>Description</label>
            <input id="verDesc" value="Donate Way token on Pi Testnet for donations." />

            <div class="btns">
              <button class="primary" id="btnGenPiToml">Generate</button>
              <button id="btnCheckDomainAll">Run Checklist</button>
            </div>

            <label>Generated pi.toml</label>
            <textarea id="tomlOut"></textarea>

            <pre id="domainOut"></pre>
          </div>
        </div>

        <div class="card">
          <div class="hd"><b>Home Domain</b><span>Issuer home_domain</span></div>
          <div class="bd">
            <label>Home Domain (hostname فقط)</label>
            <input id="hdDomain" value="pi-links.netlify.app" />
            <div class="btns">
              <button id="btnSetHomeDomain">Set home_domain</button>
              <button class="primary" id="btnGetIssuerInfo">Check issuer info</button>
            </div>
            <pre id="homeDomainOut"></pre>
            <div class="muted warn">لو عندك Redirect عام للـ SPA لازم تستثني /.well-known/*</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="hd"><b>Domain Logs</b><span>frontend</span></div>
        <div class="bd">
          <pre id="domainLog"></pre>
        </div>
      </div>
    </div>

    <footer class="muted" style="text-align:center;padding:8px">
      Testnet فقط — الأسرار في Netlify env — لا تضع secrets في الفرونت.
    </footer>

    <script src="./app.js"></script>
  </div>
</body>
</html>
